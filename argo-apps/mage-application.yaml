apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: mage-ai
  namespace: argocd  # Namespace where Argo CD is installed, usually `argocd`
spec:
  project: default

  source:
    repoURL: 'https://github.com/georgezefko/kubernetes-roadmap.git'  # Direct link to Mage AI Helm repo
    targetRevision: HEAD
 
    path: apps/mage-ai/dev/
    helm:
      valueFiles:
        - values.yaml  # Path to your dev-specific values file, if using overlays
      # parameters:
      #   - name: service.type
      #     value: ClusterIP
      #   - name: ingress.enabled
      #     value: "true"
      #   - name: ingress.hosts[0].host
      #     value: mage.local
      #   - name: ingress.hosts[0].paths[0].path
      #     value: /
      #   - name: ingress.hosts[0].paths[0].pathType
      #     value: Prefix
      #   - name: ingress.annotations.nginx.ingress.kubernetes.io/rewrite-target
      #     value: /

  destination:
    server: https://kubernetes.default.svc  # This points to the in-cluster Kubernetes API
    namespace: develop

  syncPolicy:
    automated:
      prune: true  # Automatically remove resources no longer in the chart
      selfHeal: true  # Automatically apply changes in the chart
